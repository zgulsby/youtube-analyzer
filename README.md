# YouTube Scraper for Cloudflare Workers

This Cloudflare Worker scrapes YouTube periodically for videos mentioning a specific keyword (e.g., "RunPod"), checks if they are truly new or just newly popular within the search results, and sends notifications to a Slack channel.

## Features

*   Monitors YouTube search results for a specific keyword.
*   Uses Cloudflare KV storage to remember seen videos and avoid duplicate notifications.
*   Categorizes notifications:
    *   **âœ¨ Brand New**: Videos published within a configurable time window (default: 24 hours).
    *   **ðŸ“ˆ Newly Popular**: Older videos that have recently entered the top search results.
*   Sends formatted notifications to Slack with video details and a watch button.
*   Can be run on a schedule (via Cron Triggers) or triggered manually via HTTP POST.
*   Includes an HTTP DELETE endpoint to clear the cache of seen videos.

## Prerequisites

*   [Node.js](https://nodejs.org/) (includes npm)
*   A [Cloudflare account](https://dash.cloudflare.com/sign-up)
*   [Wrangler CLI](https://developers.cloudflare.com/workers/wrangler/install-and-update/) (`npm install -g wrangler`)
*   A [YouTube Data API v3 Key](https://developers.google.com/youtube/v3/getting-started)
*   A [Slack Incoming Webhook URL](https://api.slack.com/messaging/webhooks)

## Setup

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/zgulsby/youtube-analyzer.git
    cd youtube-analyzer
    ```

2.  **Install dependencies:**
    ```bash
    npm install
    ```

3.  **Log in to Wrangler:**
    ```bash
    wrangler login
    ```

4.  **Create KV Namespace:**
    This stores the IDs of videos already seen.
    ```bash
    wrangler kv namespace create seen_videos
    ```
    Copy the `id` value generated by this command.

5.  **Configure `wrangler.toml`:**
    *   Open the `wrangler.toml` file.
    *   Replace `"YOUR_KV_NAMESPACE_ID"` for both `id` and `preview_id` under `[[kv_namespaces]]` with the actual ID you copied in the previous step.
    *   Customize `SEARCH_QUERY` (the keyword to search for on YouTube).
    *   (Optional) Adjust `MAX_RESULTS` (default is 10).
    *   (Optional) Adjust `NEWNESS_WINDOW_HOURS` (default is 24).

6.  **Add Secrets:**
    Your YouTube API Key and Slack Webhook URL should be stored securely as secrets. **Do not commit them to your code or `wrangler.toml`.**
    ```bash
    # Enter your YouTube API Key when prompted
    wrangler secret put YOUTUBE_API_KEY

    # Enter your Slack Webhook URL when prompted
    wrangler secret put SLACK_WEBHOOK_URL
    ```

## Deployment

Deploy the worker to your Cloudflare account:
```bash
wrangler deploy
```

## Usage

### Scheduled Runs (Cron Trigger)

This is the recommended way to run the scraper automatically.

1.  Go to your Cloudflare Dashboard.
2.  Navigate to Workers & Pages -> Your Worker (`runpod-youtube-scraper` or the name in `wrangler.toml`).
3.  Go to the "Triggers" tab.
4.  Under "Cron Triggers", click "Add Cron Trigger".
5.  Enter a schedule (e.g., `0 * * * *` to run every hour on the hour).
6.  Click "Add trigger".

*(Alternatively, you can define cron triggers directly in `wrangler.toml` - see [Cloudflare Cron Triggers documentation](https://developers.cloudflare.com/workers/platform/triggers/cron-triggers/#add-cron-triggers))*.

### Manual Trigger

You can manually trigger a search by sending an HTTP POST request to the worker's URL (shown after deployment):
```bash
curl -X POST https://<your-worker-name>.<your-subdomain>.workers.dev
```
This will return a JSON response indicating success or failure and the number of videos found/processed.

### Clear Seen Videos Cache

To force the worker to re-process all videos currently in the top results (useful for testing or after configuration changes), you can clear the KV store by sending an HTTP DELETE request:
```bash
curl -X DELETE https://<your-worker-name>.<your-subdomain>.workers.dev
```

## License

[MIT](./LICENSE) 